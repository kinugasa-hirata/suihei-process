<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ°´å¹³ãƒã‚ºãƒ«æ¤œæŸ»æˆç¸¾æ›¸</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <style>
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      background-color: #f5f5f5;
      padding: 20px 0;
    }

    .container {
      max-width: 1200px;
      background: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .inspection-sheet {
      background: white;
      padding: 20px;
      border: 2px solid #000;
    }

    .inspection-header {
      margin-bottom: 20px;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .header-title {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      flex-grow: 1;
    }

    .company-name {
      text-align: right;
      font-size: 18px;
      font-weight: bold;
    }

    .header-info {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .header-info > div {
      margin-right: 20px;
      margin-bottom: 5px;
    }

    .environment-note {
      font-size: 12px;
      margin: 15px 0;
      padding: 10px;
      background-color: #f8f9fa;
      border-left: 4px solid #0d6efd;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #000;
      padding: 4px 2px;
      text-align: center;
      vertical-align: middle;
    }

    th {
      background-color: #e9ecef;
      font-weight: bold;
      font-size: 10px;
    }

    .header-cell {
      background-color: #d3d3d3;
      font-weight: bold;
    }

    .measurement-cell {
      min-width: 35px;
    }

    .tolerance-row {
      background-color: #f8f9fa;
      font-size: 10px;
    }

    .invalid-value {
      color: #dc3545;
      font-weight: bold;
    }

    .rotate-text {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      white-space: nowrap;
    }

    .result-cell {
      font-weight: bold;
    }

    .footer-note {
      margin-top: 20px;
      font-size: 12px;
      padding: 10px;
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
    }

    /* PRINT STYLES - Clean PDF */
    @media print {
      @page {
        margin: 10mm 8mm;
        size: A4 portrait;
      }
      
      body {
        margin: 0;
        padding: 0;
        background: white;
      }
      
      .no-print {
        display: none !important;
      }
      
      .container {
        max-width: 100%;
        margin: 0;
        padding: 0;
        box-shadow: none;
      }
      
      .inspection-sheet {
        box-shadow: none;
        border: 1px solid #000;
        padding: 10px;
      }
      
      * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
      
      table {
        page-break-inside: auto;
      }
      
      tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }
      
      thead {
        display: table-header-group;
      }
      
      .inspection-header,
      .header-section,
      .environment-note {
        page-break-after: avoid;
      }
      
      th, td {
        font-size: 10px;
        padding: 3px 2px;
      }
    }

    /* Button Styles */
    .print-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      color: white;
    }

    .print-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .instruction-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      margin: 20px auto;
      max-width: 1200px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .instruction-content {
      background: rgba(255,255,255,0.95);
      color: #333;
      padding: 20px;
      border-radius: 8px;
    }

    .hint-box {
      margin-top: 15px;
      padding: 12px;
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <!-- Print Instructions - Hidden when printing -->
  <div class="no-print instruction-box">
    <h3 style="margin-top: 0; font-size: 20px;">ğŸ“„ ãã‚Œã„ãªPDFã‚’ä¿å­˜ã™ã‚‹æ–¹æ³•</h3>
    <div class="instruction-content">
      <p style="margin-top: 0; font-weight: 600; font-size: 16px;">å°åˆ·è¨­å®š (é‡è¦!):</p>
      <ol style="line-height: 2; margin-bottom: 0; padding-left: 25px; font-size: 15px;">
        <li>ä¸‹ã® <strong style="color: #667eea;">ã€ŒğŸ–¨ï¸ PDFä¿å­˜ã€</strong> ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
        <li><strong>é€ä¿¡å…ˆ</strong> â†’ <strong style="color: #667eea;">ã€ŒPDFã«ä¿å­˜ã€</strong> ã‚’é¸æŠ</li>
        <li><strong>ã€Œè©³ç´°è¨­å®šã€</strong> ã¾ãŸã¯ <strong>ã€Œãã®ä»–ã®è¨­å®šã€</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
        <li>âš ï¸ <strong style="color: #dc3545;">ã€Œãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ãƒƒã‚¿ãƒ¼ã€ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™</strong> â† ã“ã‚ŒãŒé‡è¦!</li>
        <li><strong style="color: #28a745;">ã€Œä¿å­˜ã€</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
      </ol>
      <div class="hint-box">
        <strong style="color: #856404;">ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ãƒƒã‚¿ãƒ¼ã‚’ç„¡åŠ¹ã«ã—ãªã„ã¨ã€URLãƒ»æ—¥ä»˜ãƒ»ãƒšãƒ¼ã‚¸ç•ªå·ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
      </div>
    </div>
  </div>

  <!-- Print Button -->
  <div class="no-print" style="text-align: center; margin: 20px auto; max-width: 1200px;">
    <button onclick="printInspectionSheet()" class="btn print-btn">
      ğŸ–¨ï¸ PDFä¿å­˜ / å°åˆ·
    </button>
    <p style="margin-top: 10px; color: #666; font-size: 14px;">
      Ctrl+P (Windows) ã¾ãŸã¯ Cmd+P (Mac) ã§ã‚‚å°åˆ·ã§ãã¾ã™
    </p>
    <a href="/" class="btn btn-secondary" style="margin-top: 10px;">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
  </div>

  <div class="container">
    <div class="inspection-sheet">
      <!-- Header Section -->
      <div class="inspection-header">
        <div class="header-row">
          <div class="header-title">æ°´å¹³ãƒã‚ºãƒ«å…¨æ•°æ¤œæŸ»æˆç¸¾æ›¸</div>
          <div class="company-name">ãˆ±å¹³ç”°å•†åº—</div>
        </div>

        <div class="header-info">
          <div><strong>å“å:</strong> æ°´å¹³ãƒã‚ºãƒ«</div>
          <div><strong>ä»•æ§˜æ›¸ç•ªå·:</strong> KDMP-0434</div>
          <div><strong>æ‹…å½“è€…:</strong> <%= inspectorName %></div>
        </div>

        <div class="header-info">
          <div><strong>å›³ç•ª:</strong> P2MM302000</div>
          <div><strong>æ•°é‡:</strong> <%= files.length %>å€‹</div>
          <div><strong>æ¤œæŸ»æ–¹æ³•:</strong> å…¨æ•°æ¤œæŸ»</div>
          <div><strong>æ¤œæŸ»æ—¥:</strong> <%= new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '/') %></div>
          <div><strong>ç´æœŸ:</strong> YYYY/MM/DD</div>
        </div>
      </div>

      <!-- Environment Note -->
      <div class="environment-note">
        å½“ç¤¾æ¤œæŸ»ã«ãŠã‘ã‚‹ç’°å¢ƒã¯å®¤æ¸©20â„ƒÂ±5â„ƒã€æ¹¿åº¦40%Â±25%ã§ç®¡ç†ã•ã‚ŒãŸéƒ¨å±‹ã§å®Ÿæ–½ã—ã¦ãŠã‚Šã¾ã™ã€‚
      </div>

      <!-- Measurement Table -->
      <div style="margin-top: 15px; text-align: right; font-weight: bold;">å˜ä½ (mm)</div>
      
      <table>
        <thead>
          <tr>
            <th rowspan="3" style="width: 60px;">å›³é¢å¯¸æ³•</th>
            <th>8.2</th>
            <th>37.5</th>
            <th>15.9</th>
            <th>24.1</th>
            <th>Î¦11.2</th>
            <th>Î¦3.2<br>å…¨å‘¨</th>
            <th>Î¦8.0</th>
            <th>æ·±ã•5.0</th>
            <th>P.C.D 30</th>
            <th>Î¦155.4</th>
            <th>83.1</th>
            <th>Î¦122.3</th>
            <th rowspan="3">æ‹¡ã‚åˆ<br>ã„</th>
            <th rowspan="3">ç›®è¦–ç‚¹<br>æ¤œ</th>
            <th rowspan="3">(å‚è€ƒ<br>å€¤)</th>
          </tr>
          <tr>
            <th>Â±0.2</th>
            <th>Â±0.3</th>
            <th>Â±0.2</th>
            <th>Â±0.2</th>
            <th>+0.2/0</th>
            <th>Â±0.1</th>
            <th>Â±0.2</th>
            <th>Â±0.1</th>
            <th>Â±0.2</th>
            <th>Â±0.5</th>
            <th>Â±0.3</th>
            <th>Â±0.5</th>
          </tr>
          <tr class="header-cell">
            <th>A</th>
            <th>B</th>
            <th>C</th>
            <th>D</th>
            <th>E</th>
            <th>F</th>
            <th>G</th>
            <th>H</th>
            <th>I</th>
            <th>J</th>
            <th>K</th>
            <th>L</th>
          </tr>
          <tr class="tolerance-row">
            <th>ä¸Šé™å€¤</th>
            <th>8.4</th>
            <th>37.8</th>
            <th>16.1</th>
            <th>24.3</th>
            <th>11.4</th>
            <th>3.3</th>
            <th>8.2</th>
            <th>5.1</th>
            <th>30.2</th>
            <th>155.9</th>
            <th>83.4</th>
            <th>122.8</th>
            <th>-</th>
            <th>-</th>
            <th>-</th>
          </tr>
          <tr class="tolerance-row">
            <th>ä¸‹é™å€¤</th>
            <th>8.0</th>
            <th>37.2</th>
            <th>15.7</th>
            <th>23.9</th>
            <th>11.2</th>
            <th>3.1</th>
            <th>7.8</th>
            <th>4.9</th>
            <th>29.8</th>
            <th>154.9</th>
            <th>82.8</th>
            <th>121.8</th>
            <th>-</th>
            <th>-</th>
            <th>-</th>
          </tr>
          <tr class="header-cell">
            <th>æ¸¬å®šå™¨</th>
            <th colspan="2">ä¸‰æ¬¡å…ƒæ¸¬å®šå™¨</th>
            <th colspan="2">ä¸‰æ¬¡å…ƒæ¸¬å®šå™¨</th>
            <th colspan="2">ãƒ”ãƒ³ã‚²ãƒ¼ã‚¸</th>
            <th colspan="2">ä¸‰æ¬¡å…ƒæ¸¬å®šå™¨</th>
            <th colspan="5">ä¸‰æ¬¡å…ƒæ¸¬å®šå™¨</th>
            <th>æ²»å…·</th>
            <th>ç›®è¦–</th>
            <th>ç§¤</th>
          </tr>
          <tr class="header-cell">
            <th>è¨˜è¼‰äº‹é …</th>
            <th colspan="2">æ¸¬å®šå€¤</th>
            <th colspan="2">æ¸¬å®šå€¤</th>
            <th colspan="2">åˆå¦</th>
            <th colspan="2">æ¸¬å®šå€¤</th>
            <th colspan="5">æ¸¬å®šå€¤</th>
            <th>åˆå¦</th>
            <th>åˆå¦</th>
            <th>é‡é‡(g)</th>
          </tr>
        </thead>
        <tbody>
          <% files.forEach(function(file) { 
            var measurements = fileData[file.$id];
            var fileNumber = file.filename.replace(/\.txt$/i, '');
          %>
          <tr>
            <td><strong><%= fileNumber %></strong></td>
            
            <!-- Column A -->
            <td class="measurement-cell <%= !measurements.A.isValid ? 'invalid-value' : '' %>">
              <%= measurements.A.value %>
            </td>
            
            <!-- Column B -->
            <td class="measurement-cell <%= !measurements.B.isValid ? 'invalid-value' : '' %>">
              <%= measurements.B.value %>
            </td>
            
            <!-- Column C -->
            <td class="measurement-cell <%= !measurements.C.isValid ? 'invalid-value' : '' %>">
              <%= measurements.C.value %>
            </td>
            
            <!-- Column D -->
            <td class="measurement-cell <%= !measurements.D.isValid ? 'invalid-value' : '' %>">
              <%= measurements.D.value %>
            </td>
            
            <!-- Column E -->
            <td class="result-cell <%= !measurements.E.isValid ? 'invalid-value' : '' %>">
              <%= measurements.E.isValid ? 'åˆ' : 'å¦' %>
            </td>
            
            <!-- Column F -->
            <td class="result-cell <%= !measurements.F.isValid ? 'invalid-value' : '' %>">
              <%= measurements.F.isValid ? 'åˆ' : 'å¦' %>
            </td>
            
            <!-- Column G (Combined G1-G4) -->
            <td class="result-cell <%= !measurements.G.isValid ? 'invalid-value' : '' %>" 
                <% if (!measurements.G.isValid && measurements.G.value !== '-') { %>
                  title="ä¸åˆæ ¼: <%= measurements.G.value %>"
                <% } %>>
              <%= measurements.G.isValid ? 'åˆ' : 'å¦' %>
            </td>
            
            <!-- Column H -->
            <td class="measurement-cell <%= !measurements.H.isValid ? 'invalid-value' : '' %>">
              <%= measurements.H.value %>
            </td>
            
            <!-- Column I -->
            <td class="measurement-cell <%= !measurements.I.isValid ? 'invalid-value' : '' %>">
              <%= measurements.I.value %>
            </td>
            
            <!-- Column J -->
            <td class="measurement-cell <%= !measurements.J.isValid ? 'invalid-value' : '' %>">
              <%= measurements.J.value %>
            </td>
            
            <!-- Column K -->
            <td class="measurement-cell <%= !measurements.K.isValid ? 'invalid-value' : '' %>">
              <%= measurements.K.value %>
            </td>
            
            <!-- Column L -->
            <td class="measurement-cell <%= !measurements.L.isValid ? 'invalid-value' : '' %>">
              <%= measurements.L.value %>
            </td>
            
            <!-- Column M (Manual) -->
            <td class="result-cell">-</td>
            
            <!-- Column N (Visual) -->
            <td class="result-cell">-</td>
            
            <!-- Weight -->
            <td class="measurement-cell">
              <%= file.weight ? Number(file.weight).toFixed(1) : '-' %>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>

      <!-- Footer Note -->
      <div class="footer-note">
        â€»ç€è„±å®¹æ˜“ãªã‚·ãƒ¼ãƒ«ã«è­˜åˆ¥ç•ªå·ã‚’è¨˜è¼‰ã—è£½å“è£ã®åº•é¢ã«è²¼ã‚Šä»˜ã‘ã‚‹ã€‚
      </div>
    </div>
  </div>

  <script>
    function printInspectionSheet() {
      // Set clean title for PDF filename
      const originalTitle = document.title;
      const today = new Date();
      const dateStr = today.getFullYear() + 
                      String(today.getMonth() + 1).padStart(2, '0') + 
                      String(today.getDate()).padStart(2, '0');
      
      document.title = 'æ°´å¹³ãƒã‚ºãƒ«å…¨æ•°æ¤œæŸ»æˆç¸¾æ›¸_' + dateStr;
      
      // Small delay to ensure title is set
      setTimeout(function() {
        window.print();
        
        // Restore original title after print dialog closes
        setTimeout(function() {
          document.title = originalTitle;
        }, 100);
      }, 100);
    }
    
    // Also set title when user uses Ctrl+P / Cmd+P
    window.addEventListener('beforeprint', function() {
      const today = new Date();
      const dateStr = today.getFullYear() + 
                      String(today.getMonth() + 1).padStart(2, '0') + 
                      String(today.getDate()).padStart(2, '0');
      document.title = 'æ°´å¹³ãƒã‚ºãƒ«å…¨æ•°æ¤œæŸ»æˆç¸¾æ›¸_' + dateStr;
    });
  </script>
</body>
</html>