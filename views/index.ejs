<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer src="/_vercel/insights/script.js"></script>
    <title>æ°´å¹³ãƒã‚ºãƒ«æ¤œæŸ»</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <style>
      .container { max-width: 1200px; margin-top: 2rem; }
      .file-selection-form, .upload-form, .action-buttons {
        padding: 1.5rem; background-color: #f8f9fa;
        border-radius: 5px; border: 1px solid #dee2e6; height: 100%;
      }
      .upload-form { display: flex; flex-direction: column; justify-content: center; align-items: center; }
      .action-buttons .btn { margin-bottom: 0.5rem; width: 100%; }
      .file-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1rem; margin-top: 1rem;
      }
      .file-card {
        background-color: #f8f9fa; border-radius: 8px; padding: 1.5rem 1rem;
        text-align: center; transition: all 0.3s ease; cursor: pointer;
        border: 2px solid #dee2e6; position: relative; user-select: none;
      }
      .file-card:hover { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border-color: #adb5bd; }
      .file-card.selected { background-color: #e3f2fd; border-color: #0d6efd; box-shadow: 0 0 0 2px #0d6efd; }
      .file-number { font-size: 2.5rem; font-weight: bold; color: #0d6efd; margin-bottom: 0.5rem; }
      .weight-section { margin-top: 0.5rem; padding: 8px; background: #fff; border-radius: 4px; }
      .weight-input {
        width: 80px; font-size: 0.9rem; padding: 0.25rem 0.5rem;
        border-radius: 4px; border: 1px solid #ced4da; text-align: center;
      }
      .weight-display { color: #666; font-size: 0.95rem; padding: 4px 8px; }
      .file-card .file-content { display: flex; flex-direction: column; align-items: center; }
      .delete-overlay {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        background-color: rgba(220, 53, 69, 0.9); display: flex;
        align-items: center; justify-content: center; color: white;
        font-weight: bold; opacity: 0; transition: opacity 0.3s ease;
        pointer-events: none; border-radius: 6px;
      }
      .file-card.deleting .delete-overlay { opacity: 1; }
      .weight-input::-webkit-outer-spin-button,
      .weight-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
      .weight-input[type="number"] { -moz-appearance: textfield; appearance: textfield; }
      .top-row { display: flex; gap: 1rem; margin-bottom: 2rem; }
      .column-left { flex: 0 0 42%; }
      .column-middle { flex: 0 0 33%; }
      .column-right { flex: 0 0 25%; }
      .user-info-header {
        position: fixed; top: 20px; right: 20px; background: white;
        padding: 12px 24px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        z-index: 1000; display: flex; align-items: center; gap: 15px;
      }
    </style>
  </head>
  <body>
    <!-- User Info Header -->
    <div class="user-info-header">
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 18px;">ğŸ‘¤</span>
        <strong style="color: #333;"><%= username %></strong>
      </div>
      <% if (canEditWeights) { %>
        <span style="background: #d4edda; color: #155724; padding: 4px 12px; border-radius: 4px; font-size: 13px; font-weight: 500;">
          âœ“ é‡é‡ç·¨é›†å¯
        </span>
      <% } else { %>
        <span style="background: #e2e3e5; color: #383d41; padding: 4px 12px; border-radius: 4px; font-size: 13px; font-weight: 500;">
          ğŸ“– é–²è¦§ã®ã¿
        </span>
      <% } %>
      <a href="/logout" class="btn btn-sm btn-outline-danger" style="margin-left: 10px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>

    <div class="container">
      <h1 class="mb-4">æ°´å¹³ãƒã‚ºãƒ«æ¤œæŸ»</h1>

      <div class="top-row">
        <div class="column-left">
          <div class="file-selection-form">
            <h3>ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</h3>
            <p>å§‹ã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ç•ªå·ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            <form id="rangeSelectForm" onsubmit="selectFileRange(event)">
              <div class="row">
                <div class="col-md-5">
                  <label for="startFile" class="form-label">å§‹ã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«</label>
                  <input type="number" class="form-control" id="startFile" name="startFile" placeholder="e.g., 240" />
                </div>
                <div class="col-md-5">
                  <label for="fileCount" class="form-label">ãƒ•ã‚¡ã‚¤ãƒ«æ•°</label>
                  <input type="number" class="form-control" id="fileCount" name="fileCount" placeholder="e.g., 10" min="1" />
                </div>
                <div class="col-md-2 d-flex align-items-end">
                  <button type="submit" class="btn btn-info w-100">é¸æŠ</button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="column-middle">
          <div class="upload-form">
            <h4 class="mb-3">æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h4>
            <form action="/upload" method="post" enctype="multipart/form-data">
              <input type="file" id="files" name="files" accept=".txt" multiple required style="display: none" onchange="this.form.submit()" />
              <input type="hidden" name="overwriteAction" value="overwrite" />
              <label for="files" class="btn btn-primary d-flex align-items-center justify-content-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload me-2" viewBox="0 0 16 16">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                  <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z" />
                </svg>
                ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
              </label>
            </form>
          </div>
        </div>

        <div class="column-right">
          <div class="action-buttons">
            <% if (canEditWeights) { %>
              <button id="saveWeightsBtn" class="btn btn-primary">ğŸ’¾ é‡é‡ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
            <% } else { %>
              <div class="alert alert-info" style="padding: 8px 12px; margin-bottom: 8px; font-size: 13px;">
                â„¹ï¸ é‡é‡ã®ç·¨é›†ã¯ <strong>naemura</strong> ã¨ <strong>iwatsuki</strong> ã®ã¿å¯èƒ½ã§ã™
              </div>
            <% } %>
            <button id="viewSelectedBtn" class="btn btn-info" disabled>æ¤œæŸ»æˆç¸¾æ›¸ä½œæˆã¸</button>
            <button id="exportWeightsBtn" class="btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download me-1" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
              </svg>
              Data Export
            </button>
            <button id="importWeightsBtn" class="btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload me-1" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
              </svg>
              Data Import
            </button>
            <input type="file" id="weightFileInput" accept=".json" style="display: none;" />
          </div>
        </div>
      </div>

      <form id="viewSelectedForm" action="/summary" method="get" style="display: none">
        <input type="hidden" name="selectedFiles" id="selectedFilesInput" value="" />
      </form>

      <h2 class="mb-3">ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h2>

      <% if (files && files.length > 0) { %>
      <div class="file-grid">
        <% 
        var sortedFiles = [];
        files.forEach(function(file) { sortedFiles.push(file); });
        sortedFiles.sort(function(a, b) {
          var numA = parseInt((a.filename.match(/^\d+/) || ['0'])[0], 10);
          var numB = parseInt((b.filename.match(/^\d+/) || ['0'])[0], 10);
          return numA - numB;
        });
        sortedFiles.forEach(function(file) {
          var fileNumber = file.filename;
          var match = file.filename.match(/^(\d+)/);
          if (match) { fileNumber = match[1]; }
        %>
        <div class="file-card" data-file-id="<%= file.$id %>" data-filename="<%= file.filename %>">
          <div class="delete-overlay">Release to Delete</div>
          <div class="file-content">
            <div class="file-number"><%= fileNumber %></div>
            
            <div class="weight-section">
              <% if (canEditWeights) { %>
                <input type="number" class="weight-input" data-file-id="<%= file.$id %>" step="0.1" value="<%= file.weight || '' %>" placeholder="Weight (g)" />
                <% if (file.weight) { %>
                  <div class="weight-display" style="margin-top: 4px; font-size: 0.85rem;">
                    <%= parseFloat(file.weight).toFixed(1) %> g
                  </div>
                <% } %>
              <% } else { %>
                <div class="weight-display">
                  <strong>é‡é‡:</strong>
                  <%= file.weight ? parseFloat(file.weight).toFixed(1) + ' g' : 'æœªè¨­å®š' %>
                </div>
              <% } %>
            </div>
            
            <div class="view-data-link mt-2">
              <a href="/files/<%= file.$id %>" class="btn btn-sm btn-outline-secondary" style="padding: 4px; font-size: 0.8rem; border-radius: 50%" onclick="event.stopPropagation();">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
              </a>
            </div>
          </div>
        </div>
        <% }); %>
      </div>
      <% } else { %>
      <div class="alert alert-info"><p>æ°´å¹³ãƒã‚ºãƒ«æ¤œæŸ»ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</p></div>
      <% } %>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const fileCards = document.querySelectorAll(".file-card");
        const selectedFiles = new Set();
        const canEditWeights = <%= canEditWeights ? 'true' : 'false' %>;
        let pressTimer;

        async function saveWeight(fileId, weight) {
          if (!canEditWeights) {
            alert('âš ï¸ æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“\n\né‡é‡ã®ç·¨é›†ã¯ naemura ã¨ iwatsuki ã®ã¿å¯èƒ½ã§ã™ã€‚');
            return false;
          }
          try {
            if (!weight || isNaN(weight)) return false;
            const formattedWeight = parseFloat(weight).toFixed(1);
            const response = await fetch("/update-weights", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ weights: [{ fileId, weight: formattedWeight }] }),
            });
            if (!response.ok) {
              const error = await response.json();
              throw new Error(error.error || 'Failed to save weight');
            }
            const result = await response.json();
            if (result.success) {
              const card = document.querySelector(`.file-card[data-file-id="${fileId}"]`);
              let weightDisplay = card.querySelector(".weight-display");
              if (!weightDisplay) {
                weightDisplay = document.createElement("div");
                weightDisplay.className = "weight-display";
                weightDisplay.style.marginTop = "4px";
                weightDisplay.style.fontSize = "0.85rem";
                card.querySelector(".weight-section").appendChild(weightDisplay);
              }
              weightDisplay.textContent = `${formattedWeight} g`;
              return true;
            }
            return false;
          } catch (error) {
            console.error("Error:", error);
            if (error.message.includes('Not authorized')) {
              alert('âš ï¸ æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“\n\né‡é‡ã®ç·¨é›†ã¯ naemura ã¨ iwatsuki ã®ã¿å¯èƒ½ã§ã™ã€‚');
            } else {
              alert('âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
            return false;
          }
        }

        <% if (canEditWeights) { %>
        document.querySelectorAll(".weight-input").forEach((input, index, inputs) => {
          input.addEventListener("change", async function (e) {
            let weight = this.value;
            const fileId = this.dataset.fileId;
            if (weight && !isNaN(weight)) {
              if (!weight.includes(".")) weight += ".0";
              await saveWeight(fileId, weight);
            }
          });
          input.addEventListener("focus", function () {
            this.setSelectionRange(this.value.length, this.value.length);
          });
          input.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              e.preventDefault();
              const nextInput = inputs[index + 1];
              if (nextInput) nextInput.focus();
              else this.blur();
            }
          });
          input.addEventListener("click", function(e) { e.stopPropagation(); });
        });

        const saveWeightsBtn = document.getElementById("saveWeightsBtn");
        if (saveWeightsBtn) {
          saveWeightsBtn.addEventListener("click", async function () {
            try {
              const weightInputs = document.querySelectorAll(".weight-input");
              const weights = [];
              weightInputs.forEach((input) => {
                const fileId = input.dataset.fileId;
                const weight = input.value;
                if (weight && !isNaN(weight)) {
                  weights.push({ fileId, weight: parseFloat(weight).toFixed(1) });
                }
              });
              if (weights.length === 0) {
                alert("ä¿å­˜ã™ã‚‹é‡é‡ãŒã‚ã‚Šã¾ã›ã‚“!");
                return;
              }
              const response = await fetch("/update-weights", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ weights }),
              });
              if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Failed to save');
              }
              const result = await response.json();
              if (result.success) {
                alert(`âœ“ ${result.count}ä»¶ã®é‡é‡ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ`);
                weights.forEach(({ fileId, weight }) => {
                  const card = document.querySelector(`.file-card[data-file-id="${fileId}"]`);
                  let weightDisplay = card.querySelector(".weight-display");
                  if (!weightDisplay) {
                    weightDisplay = document.createElement("div");
                    weightDisplay.className = "weight-display";
                    weightDisplay.style.marginTop = "4px";
                    weightDisplay.style.fontSize = "0.85rem";
                    card.querySelector(".weight-section").appendChild(weightDisplay);
                  }
                  weightDisplay.textContent = `${weight} g`;
                });
              }
            } catch (error) {
              console.error("Error:", error);
              if (error.message.includes('Not authorized')) {
                alert('âš ï¸ æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“\n\né‡é‡ã®ç·¨é›†ã¯ naemura ã¨ iwatsuki ã®ã¿å¯èƒ½ã§ã™ã€‚');
              } else {
                alert("âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: " + error.message);
              }
            }
          });
        }
        <% } %>

        function updateSummaryForm() {
          const viewSelectedBtn = document.getElementById("viewSelectedBtn");
          const selectedFilesInput = document.getElementById("selectedFilesInput");
          if (selectedFiles.size > 0) {
            viewSelectedBtn.disabled = false;
            viewSelectedBtn.textContent = `é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼š${selectedFiles.size}`;
            selectedFilesInput.value = Array.from(selectedFiles).join(",");
          } else {
            viewSelectedBtn.disabled = true;
            viewSelectedBtn.textContent = "æ¤œæŸ»æˆç¸¾æ›¸ä½œæˆã¸";
            selectedFilesInput.value = "";
          }
        }

        function toggleFileSelection(card) {
          const fileId = card.dataset.fileId;
          if (card.classList.contains("selected")) {
            selectedFiles.delete(fileId);
            card.classList.remove("selected");
          } else {
            selectedFiles.add(fileId);
            card.classList.add("selected");
          }
          updateSummaryForm();
        }

        window.selectFileRange = function (event) {
          event.preventDefault();
          const startFile = parseInt(document.getElementById("startFile").value);
          const fileCount = parseInt(document.getElementById("fileCount").value);
          if (isNaN(startFile) || isNaN(fileCount) || fileCount < 1) {
            alert("æœ‰åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ç•ªå·ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
          }
          const endFile = startFile + fileCount - 1;
          selectedFiles.clear();
          fileCards.forEach((card) => card.classList.remove("selected"));
          fileCards.forEach((card) => {
            const filename = card.dataset.filename;
            const fileNumber = parseInt(filename.match(/^\d+/)?.[0]);
            if (fileNumber >= startFile && fileNumber <= endFile) {
              card.classList.add("selected");
              selectedFiles.add(card.dataset.fileId);
            }
          });
          updateSummaryForm();
        };

        document.getElementById("viewSelectedBtn").addEventListener("click", function (e) {
          e.preventDefault();
          if (selectedFiles.size > 0) {
            document.getElementById("viewSelectedForm").submit();
          }
        });

        fileCards.forEach((card) => {
          card.addEventListener("click", function (e) {
            if (!e.target.closest("input") && !e.target.closest("a")) {
              toggleFileSelection(this);
            }
          });

          card.addEventListener("mousedown", function (e) {
            if (e.target.closest("input") || e.target.closest("a")) return;
            pressTimer = setTimeout(() => { card.classList.add("deleting"); }, 2000);
          });

          card.addEventListener("mouseup", function () {
            clearTimeout(pressTimer);
            if (card.classList.contains("deleting")) {
              card.classList.remove("deleting");
              if (confirm(`æœ¬å½“ã«ãƒ•ã‚¡ã‚¤ãƒ« ${card.dataset.filename} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                fetch("/delete-file", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ fileId: card.dataset.fileId }),
                })
                  .then((response) => response.json())
                  .then((result) => {
                    if (result.success) {
                      card.remove();
                      alert("âœ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ");
                    } else {
                      throw new Error(result.error || "å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");
                    }
                  })
                  .catch((error) => {
                    console.error("Error:", error);
                    alert("âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼: " + error.message);
                  });
              }
            }
          });

          card.addEventListener("mouseleave", function () {
            clearTimeout(pressTimer);
            card.classList.remove("deleting");
          });
        });

        const exportWeightsBtn = document.getElementById("exportWeightsBtn");
        if (exportWeightsBtn) {
          exportWeightsBtn.addEventListener("click", async function() {
            try {
              const response = await fetch('/export-weights');
              if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
              const data = await response.json();
              if (!data || data.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
              }
              const jsonStr = JSON.stringify(data, null, 2);
              const blob = new Blob([jsonStr], { type: 'application/json' });
              const today = new Date();
              const dateStr = today.getFullYear() + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0');
              const url = URL.createObjectURL(blob);
              const link = document.createElement('a');
              link.href = url;
              link.download = `weight_data_${dateStr}.json`;
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              URL.revokeObjectURL(url);
            } catch (error) {
              console.error('Error:', error);
              alert('âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
          });
        }

        const importWeightsBtn = document.getElementById("importWeightsBtn");
        const weightFileInput = document.getElementById("weightFileInput");
        if (importWeightsBtn && weightFileInput) {
          importWeightsBtn.addEventListener("click", function() { weightFileInput.click(); });
          weightFileInput.addEventListener("change", async function(e) {
            if (!this.files || this.files.length === 0) return;
            const file = this.files[0];
            try {
              const reader = new FileReader();
              reader.onload = async function(event) {
                try {
                  const weightData = JSON.parse(event.target.result);
                  if (!Array.isArray(weightData)) {
                    throw new Error("ç„¡åŠ¹ãªJSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã™ã€‚");
                  }
                  alert('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¾ã™ã€‚');
                  window.location.reload();
                } catch (error) {
                  console.error('Error:', error);
                  alert('âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message);
                }
              };
              reader.onerror = function() { alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'); };
              reader.readAsText(file);
            } catch (error) {
              console.error('Error:', error);
              alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
            this.value = '';
          });
        }
      });
    </script>
  </body>
</html>